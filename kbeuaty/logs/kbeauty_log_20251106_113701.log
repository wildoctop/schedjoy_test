--- Pipeline Start (using Poetry): Thu Nov  6 11:37:01 AM UTC 2025 ---
Log file: ../logs/kbeauty_log_20251106_113701.log
---------------------------------
Starting Step 1: Running scraper_kbeauty.py
{'cat': 'https://kbeauty.ca/collections/cream/products/cosrx-advanced-snail-92-all-in-one-cream', 'url': 'Cream', 'name': None}
Parsing product https://kbeauty.ca/collections/cream/products/dr-althea-345-relief-cream-50ml
Found 20 images
{'cat_name': 'Cream', 'Title': 'DR ALTHEA 345 Relief Cream 50mL', 'Variant SKU': '8809447251394', 'Image Src': {'//kbeauty.ca/cdn/shop/files/DR_ALTHEA_345_Relief_Cream_50mL_5.webp?v=1747992178&width=1000', '//kbeauty.ca/cdn/shop/files/DR_ALTHEA_345_Relief_Cream_50mL_3.webp?v=1747992183&width=1000', '//kbeauty.ca/cdn/shop/files/DR_ALTHEA_345_Relief_Cream_50mL10.webp?v=1747992179&width=1000', '//kbeauty.ca/cdn/shop/files/DR_ALTHEA_345_Relief_Cream_50mL_6.webp?v=1747992189&width=1000', '//kbeauty.ca/cdn/shop/files/DR_ALTHEA_345_Relief_Cream_50mL_9.webp?v=1747992185&width=1000', '//kbeauty.ca/cdn/shop/files/DR_ALTHEA_345_Relief_Cream_50mL_1.webp?v=1747992175&width=1000', '//kbeauty.ca/cdn/shop/files/DR_ALTHEA_345_Relief_Cream_50mL8.webp?v=1747992187&width=1000', '//kbeauty.ca/cdn/shop/files/DR_ALTHEA_345_Relief_Cream_50mL7.webp?v=1747992182&width=1000', '//kbeauty.ca/cdn/shop/files/DR_ALTHEA_345_Relief_Cream_50mL_2.webp?v=1747992181&width=1000', '//kbeauty.ca/cdn/shop/files/DR_ALTHEA_345_Relief_Cream_50mL_4.webp?v=1747992176&width=1000'}, 'Body (HTML)': "Description\n      \n\n\n\n\n\n\n\nSIZE: 50MLSKIN TYPE: ALL SKIN TYPES | SENSITIVE SKIN | ACNE-PRONE | DRY SKINIDEAL FOR: SOOTHING | INTENSE HYDRATION | NOURISHING | REGENERATE SKIN | BLEMISHES | ANTI-AGING | STRENGTHENS SKIN BARRIER | DARK SPOTS | HYPERPIGMENTATION | ELASTICITY\xa0 |ANTIOXIDANT PROTECTION | FINE LINES | WRINKLES | GLOWING | RADIANCE | CALMING IRRITATION\xa0\xa0FORMULATION: CREAM | LIGHTWEIGHT |VEGAN | PARABEN FREE | FRAGRANCE FREE\xa0\nDr. Althea 345 Relief Cream is a lightweight, nutrient-rich gel-cream designed to soothe, nourish, and regenerate the skin while addressing acne aftermath, blemishes, and signs of aging. Enriched with Niacinamide, Panthenol, and Opuntia Ficus-Indica Stem Extract (10,000ppm each), it strengthens the moisture barrier, regulates oil production, fades dark spots, and provides deep hydration for dry and sensitive skin. The addition of Resveratrol delivers powerful antioxidant protection, enhances cell turnover, and improves elasticity, while Adenosine smooths fine lines for a glowing complexion.\nThe formula also features Centella Asiatica Extract and plant-based hydrators that calm irritation, alongside Calendula Extract, Sunflower Extract, and Propolis to provide long-lasting moisture and nourishment. Its multi-layered cream structure ensures continuous hydration without a greasy residue, making it suitable for sensitive skin. Vegan-certified and EWG Green Grade-rated, it is free of parabens, sulfates, artificial colors, animal products, alcohol, mineral oil, and fragrance, prioritizing both skin and environmental safety.\nHOW TO USE\n\n\n\n\n\nWash your face with a gentle cleanser suited for your skin type.\n\n\nApply less viscous skincare products like toner first.\n\n\nApply an adequate amount of the 345 Barrier Cream as your final or semi-final step in your skincare routine.\n\n\n\n***For external use only. Always patch test before use to check for sensitivity. Discontinue if irritation occurs, and consult a dermatologist if needed. Results may vary depending on individual skin type and condition.\n\n\nINGREDIENTS\nKey Ingredients:\n\n\nNiacinamide: Enhances skin's moisture barrier, regulates oil production, brightens skin tone, and fades dark spots.\n\nPanthenol: Provides hydration, soothes and repairs irritated skin.\n\nOenothera Biennis (Evening Primrose) Flower Extract: Moisturizes and helps improve skin elasticity.\n\nCurcuma Longa (Turmeric) Root Extract: Antioxidant-rich, brightens skin and reduces inflammation.\n\nCentella Asiatica Leaf Extract: Calms and heals the skin, promotes collagen production.\n\nSodium Hyaluronate: Powerful humectant that draws moisture into the skin, hydrating and plumping.\n\nAdenosine: Soothes, reduces the appearance of wrinkles, and promotes collagen production.\n\nTocopherol (Vitamin E): Antioxidant that protects the skin from free radical damage.\n\nCeramide NP: Helps restore the skin barrier and retain moisture.\n\nWater, Propanediol, Glycerin, Cyclohexasiloxane, 1,2-Hexanediol, Caprylic/Capric Triglyceride, Niacinamide, Panthenol, Polyglycerin-3, Polyglyceryl-10 Stearate, Hydrogenated Poly(C6-14 Olefin), Hydrogenated Polydecene, Laminaria Japonica Extract, Eclipta Prostrata Leaf Extract, Melia Azadirachta Flower Extract, Houttuynia Cordata Extract, Melia Azadirachta Leaf Extract, Oenothera Biennis (Evening Primrose) Flower Extract, Curcuma Longa (Turmeric) Root Extract, Ocimum Sanctum Leaf Extract, Calendula Officinalis Flower Extract, Agave Tequilana Leaf Extract, Sargassum Fulvellum Extract, Corallina Officinalis Extract, Lavandula Angustifolia (Lavender) Flower Extract, Centella Asiatica Leaf Extract, Opuntia Ficus-Indica Stem Extract, Gardenia Florida Fruit Extract, Perilla Ocymoides Leaf Extract, Hibiscus Sabdariffa Flower Extract, Sodium Hyaluronate, Hydrogenated Lecithin, Empetrum Nigrum Fruit Juice, Dicaprylyl Carbonate, C14-22 Alcohols, Ammonium Acryloyldimethyltaurate/Vp Copolymer, Polymethylsilsesquioxane, Dipropylene Glycol, Butylene Glycol, C12-20 Alkyl Glucoside, Acrylates/C10-30 Alkyl Acrylate Crosspolymer, Ethylhexylglycerin, Polyquaternium-51, Tromethamine, Fructooligosaccharides, Adenosine, Beta-Glucan, Glycine Soja (Soybean) Sterols, PEG-40 Castor Oil, Hydrolyzed Hyaluronic Acid, Resveratrol, Tocopherol, Ceramide Np, Oligopeptide-1, Phenoxyethanol, Potassium Sorbate\n*This list of ingredients represents all options or variants of this product. Actual ingredients in a given product option may vary from this list.\n*Ingredients subject to change at manufacturer's discretion. For the most complete and up-to-date list of ingredients, please refer to product packaging or manufacturer's website.", 'Variant Barcode': '8809447251394', 'Variant Image': '', 'Variant Price': '$28.85', 'Variant Compare At Price': '$33.95', 'Vendor': 'KBeauty', 'Option1 name': '', 'Option1 value': ''}
[]
Traceback (most recent call last):
  File "/home/parser/schedjoy_test/kbeuaty/scripts/scraper_kbeauty.py", line 1188, in <module>
    products = scrape_products_all()
  File "/home/parser/schedjoy_test/kbeuaty/scripts/scraper_kbeauty.py", line 1164, in scrape_products_all
    db_status, product_id = upsert_product_data(product, [], cursor)
                            ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "/home/parser/schedjoy_test/kbeuaty/scripts/scraper_kbeauty.py", line 502, in upsert_product_data
    return upsert_single_variant(product_data, target_sku, cursor)
  File "/home/parser/schedjoy_test/kbeuaty/scripts/scraper_kbeauty.py", line 134, in upsert_single_variant
    cursor.execute(update_product_query)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "/home/parser/.cache/pypoetry/virtualenvs/kbeauty-3Lsz9dQy-py3.13/lib/python3.13/site-packages/psycopg2/sql.py", line 122, in as_string
    rv.append(i.as_string(context))
              ~~~~~~~~~~~^^^^^^^^^
  File "/home/parser/.cache/pypoetry/virtualenvs/kbeauty-3Lsz9dQy-py3.13/lib/python3.13/site-packages/psycopg2/sql.py", line 387, in as_string
    a = ext.adapt(self._wrapped)
psycopg2.ProgrammingError: can't adapt type 'set'
FATAL ERROR (1): scraper_kbeauty.py failed.
